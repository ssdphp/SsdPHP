
<div class="row">
    <div class="col-xs-12">
        <div class="clearfix">
            <div class="pull-left tableTools-container">
                <div class="dt-buttons btn-overlap btn-group">

                    <a class="dt-button buttons-collection buttons-colvis btn btn-white btn-primary btn-bold" title="添加" href="javascript:window.history.back();">
                        <span>
                            <span> << 返回 </span>
                        </span>
                    </a>
                </div>

            </div>
        </div>
        <div class="table-header">
            所在权限组：{{$accessInfo['title']}}
        </div>

        <!-- div.table-responsive -->

        <!-- div.dataTables_borderWrap -->
        <div>

            <div id="dynamic-table_wrapper" class="dataTables_wrapper form-inline no-footer">
                <div class="row">
                    <div class="am-input-group am-input-group-primary am-u-lg-8">

                        <input type="text" id="userid" class="am-form-field" placeholder="在这里输入要添加的用户uid,用逗号隔开" >
                        <style>
                            input::-webkit-input-placeholder{
                                color: green;
                                font-weight: 400;
                            }
                        </style>
                        <span class="am-input-group-btn">
                                 <a href="javascript:;" id="add" type="button" class="am-btn am-btn-primary"><span class="am-icon-plus"></span> 添加用户</a>
                            </span>

                    </div>
                </div>
                <table id="dynamic-table" class="table table-striped table-bordered table-hover dataTable no-footer" role="grid" aria-describedby="dynamic-table_info">

                    <tr>
                        <th class="table-id">UID</th>
                        <th class="table-title">帐号</th>
                        <th class="table-title">昵称</th>
                        <th class="table-set">状态</th>
                        <th class="table-set">操作</th>
                    </tr>
                    </thead>
                    <tbody>
                    {{foreach($list as $v)}}
                    <tr>
                        <td>{{$v['uid']}}</td>
                        <td>{{$v['username']}}</td>
                        <td>{{$v['nickname']}}</td>
                        <td>{{echo $v['status']==1?'正常':'禁用'}}</td>
                        <td>

                            <a href="javascript:;" ret="{{$v['uid']}}" class="status am-btn am-btn-warning am-btn-xs">解除授权</a>
                        </td>
                    </tr>
                    {{/foreach}}


                    </tbody>
                </table>

            </div>
        </div>
    </div>
</div>


<block name="content">
    <script>
        $(function () {
            $('#add').on('click',function () {
                add();
            });

            $('.status').on('click',function () {
                if(confirm("确定要解除授权吗？") == false){
                    return ;
                }
                var d = $(this).attr('ret');
                if(!d){
                    return ;
                }
                $.ajax({
                    'type':'post',
                    'url':'/auth_group/user_access_del',
                    'data':{ 'uid':d,qid:"{{$accessInfo['id']}}"},
                    'dataType':'json',
                    'success':function (ret) {
                        if(ret.code == 1){
                            zalert(ret.code_str,'icon-check am-success',1);
                        }else{
                            zalert(ret.code_str,"",1);
                        }
                        window.location.reload();
                    },'error':function (err) {
                        console.log(err);
                    }
                });
            });

            function add() {
                var uids = $('#userid').val();
                if(!uids){
                    alertify.error('用户uid未填写','warning');
                    return;
                }
                alertify.confirm(
                    '提示',
                    '确认要添加用户吗?',
                    function () {
                        $.ajax({
                            'type':'post',
                            'url':'/auth_group/user_access_add',
                            'data':{'uids':uids,'qid':'{{$accessInfo["id"]}}'},
                            'dataType':'json',
                            'success':function (ret) {
                                if(ret.code == 1){
                                    alertify.success(ret.code_str)
                                }else{
                                    alertify.error(ret.code_str)
                                }
                                window.location.reload();
                            },'error':function (err) {
                                console.log(err);
                            }
                        });
                    }, function () {}).set("labels",{ok:'确定', cancel:'取消'}).set({transition:'zoom',reverseButtons:true}) ;
            }
        })
    </script>
</block>